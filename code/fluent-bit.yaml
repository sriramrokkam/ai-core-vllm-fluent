service:
  flush: 1
  log_level: info
  http_server: on
  http_listen: 127.0.0.1
  http_port: 2020

pipeline:
  inputs:
    # Collect vLLM application logs
    - name: tail
      path: /app/logs/app.log
      tag: vllm.logs
      parser: json
      refresh_interval: 5

    # Scrape Prometheus metrics from vLLM
    - name: prometheus_scrape
      host: 127.0.0.1
      port: 8000
      tag: vllm.metrics
      metrics_path: /metrics
      scrape_interval: 30s

  outputs:
    # Send logs to Cloud Logging via Basic Auth
    - name: http
      match: vllm.logs
      host: ${OPENSEARCH_HOST}
      port: 443
      uri: /
      format: json
      json_date_key: timestamp
      json_date_format: iso8601
      http_user: ${OPENSEARCH_USER}
      http_passwd: ${OPENSEARCH_PASSWORD}
      tls: on
      tls.verify: off
      compress: gzip

    # Send metrics to Cloud Logging via Basic Auth
    - name: http
      match: vllm.metrics
      host: ${OPENSEARCH_HOST}
      port: 443
      uri: /
      format: json
      json_date_key: timestamp
      json_date_format: iso8601
      http_user: ${OPENSEARCH_USER}
      http_passwd: ${OPENSEARCH_PASSWORD}
      tls: on
      tls.verify: off
      compress: gzip
