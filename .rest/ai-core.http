###
# @name auth
POST  {{$dotenv TOKEN_URL}}/oauth/token?grant_type=client_credentials
Authorization: Basic {{$dotenv CLIENT_ID}}:{{$dotenv CLIENT_SECRET}}

@access_token = {{auth.response.body.access_token}}

# Updated deployment ID for vLLM with FluentBit logging
@DEPLOYMENT_ID = d787566d1d95f09c


###
# @name healthCheck
GET {{$dotenv URL}}/v2/inference/deployments/{{DEPLOYMENT_ID}}/health
Authorization: Bearer {{access_token}}
AI-RESOURCE-GROUP: {{$dotenv RESOURCE_GROUP}}

###
# @name getDeploymentLogs
GET {{$dotenv URL}}/v2/lm/deployments/{{DEPLOYMENT_ID}}/logs?$top=1000&$order=asc
Authorization: Bearer {{access_token}}
AI-RESOURCE-GROUP: {{$dotenv RESOURCE_GROUP}}

###
# @name vLLMCompletions
POST {{$dotenv URL}}/v2/inference/deployments/{{DEPLOYMENT_ID}}/v1/completions
Authorization: Bearer {{access_token}}
AI-RESOURCE-GROUP: {{$dotenv RESOURCE_GROUP}}
Content-Type: application/json

{
    "model": "facebook/opt-125m",
    "prompt": "The capital of France is",
    "max_tokens": 20,
    "temperature": 0.7
}

###
# @name vLLMChatCompletions
POST {{$dotenv URL}}/v2/inference/deployments/{{DEPLOYMENT_ID}}/v1/chat/completions
Authorization: Bearer {{access_token}}
AI-RESOURCE-GROUP: {{$dotenv RESOURCE_GROUP}}
Content-Type: application/json

{
    "model": "facebook/opt-125m",
    "messages": [
        {
            "role": "user",
            "content": "Write a poem about the sea."
        }
    ],
    "max_tokens": 100
}

###
# @name vLLMStreamingCompletion
POST {{$dotenv URL}}/v2/inference/deployments/{{DEPLOYMENT_ID}}/v1/completions
Authorization: Bearer {{access_token}}
AI-RESOURCE-GROUP: {{$dotenv RESOURCE_GROUP}}
Content-Type: application/json

{
    "model": "facebook/opt-125m",
    "prompt": "Once upon a time",
    "max_tokens": 50,
    "stream": true
}

###
# @name vLLMMetrics
GET {{$dotenv URL}}/v2/inference/deployments/{{DEPLOYMENT_ID}}/metrics
Authorization: Bearer {{access_token}}
AI-RESOURCE-GROUP: {{$dotenv RESOURCE_GROUP}}

###
# @name vLLMModelInfo
GET {{$dotenv URL}}/v2/inference/deployments/{{DEPLOYMENT_ID}}/v1/models
Authorization: Bearer {{access_token}}
AI-RESOURCE-GROUP: {{$dotenv RESOURCE_GROUP}}


###
# @name pushLogToCloudLogging
PUT {{$dotenv LOG_HOST}}/
Authorization: Basic {{$dotenv LOG_USER}}:{{$dotenv LOG_PASSWORD}}
Content-Type: application/json

{
    "msg": "Test log from vLLM deployment d787566d1d95f09c",
    "level": "INFO",
    "deployment_id": "d787566d1d95f09c",
    "timestamp": "${{$timestamp}}"
}